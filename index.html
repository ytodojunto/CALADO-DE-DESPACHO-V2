<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Náutica Multi-Tramo</title>

    <!-- Google Analytics (tu ID) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VTGH8J2KN8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-VTGH8J2KN8');
    </script>

    <style>
        body {font-family: Arial, sans-serif; padding:20px; background:#333; color:#fff; margin:0; transition:background .5s;}
        .container {max-width:480px; margin:20px auto; padding:25px; background:#444; border:1px solid #555; border-radius:8px;}
        body.scheme-canales {background:#1a364a;}
        .scheme-canales .container {background:#2a4c61;}
        .scheme-canales .tramo-info {border-left-color:#00e0ff;}
        #appLogo {display:block; max-width:100px; margin:0 auto 15px;}
        h2 {text-align:center; border-bottom:2px solid #555; padding-bottom:10px;}
        .tramo-info {background:#555; padding:10px; margin:15px 0; border-radius:4px; border-left:5px solid #00bcd4; font-size:0.95em;}
        .tab-button {background:#666; color:#fff; padding:10px 15px; border:none; cursor:pointer; margin:5px; font-weight:bold;}
        .tab-button.active {background:#007bff;}
        input, button {width:100%; padding:12px; margin:10px 0; box-sizing:border-box; background:#666; color:#fff; border:1px solid #888; border-radius:4px;}
        button:hover {background:#007bff;}
        #calculate-cd, #calculate-msbq {background:#008000 !important; font-size:1.1em; font-weight:900;}
        .resultado {font-size:1.5em; font-weight:bold; color:#4caf50; margin-top:20px; padding-top:15px; border-top:2px solid #777; text-align:center;}
    </style>
</head>
<body>

<div class="container">
    <img src="logo (2).png" alt="Logo" id="appLogo">
    <h2>Calculadora Náutica</h2>

    <div class="tramo-selector">
        <label>Tramo / Reglamentación:</label>
        <select id="tramoSelect" onchange="cambiarTramo(this.value)">
            <option value="parana">RÍO PARANÁ Y SUS BRAZOS</option>
            <option value="canales">CANALES (P. Indio, Intermedio, etc.)</option>
        </select>
    </div>

    <div class="tramo-info">
        Reglas aplicadas: <strong id="tramoActualDisplay">RÍO PARANÁ Y SUS BRAZOS</strong>
    </div>

    <div style="text-align:center; margin:20px 0;">
        <button class="tab-button active" onclick="mostrar('tab-cd',this)">PE → Calado Máximo</button>
        <button class="tab-button" onclick="mostrar('tab-msbq',this)">Calado → Margen</button>
    </div>

    <!-- Pestaña 1: Profundidad Efectiva → Calado Máximo -->
    <div id="tab-cd" class="tab-content">
        <h3 style="text-align:center;">Calado de Despacho Máximo</h3>
        <label>Profundidad Efectiva (PE) en metros:</label>
        <input type="number" id="peInput" step="0.01" placeholder="Ej: 11.04">
        <button id="calculate-cd" onclick="calcCaladoDesdePE()">Calcular Calado</button>
        <div class="resultado">
            Calado Máximo: <span id="resultadoCD">---</span> m
        </div>
    </div>

    <!-- Pestaña 2: Calado → Margen de Seguridad -->
    <div id="tab-msbq" class="tab-content" style="display:none;">
        <h3 style="text-align:center;">Margen de Seguridad Requerido</h3>
        <label>Calado Propio (CD) en metros:</label>
        <input type="number" id="caladoInput" step="0.01" placeholder="Ej: 10.38">
        <button id="calculate-msbq" onclick="calcMargenDesdeCD()">Calcular Margen</button>
        <div class="resultado">
            Margen de Seguridad: <span id="resultadoMSBQ">---</span> m
        </div>
    </div>
</div>

<script>
const RULES = {
    parana:  { name: "RÍO PARANÁ Y SUS BRAZOS",       class: "scheme-parana",  cdStart: 10.36, cd10porc: 10.50, incrementoCm: 3   },
    canales: { name: "CANALES (P. Indio, Intermedio, etc.)", class: "scheme-canales", cdStart: 10.36, cd10porc: 10.68, incrementoCm: 1.5 }
};
let current = RULES.parana;

// PE → Calado Máximo Permitido
function calcCaladoDesdePE() {
    const pe = parseFloat(document.getElementById('peInput').value);
    if (isNaN(pe) || pe <= 0) { document.getElementById('resultadoCD').textContent = "Inválido"; return; }

    let cd;
    if (pe <= 10.96) cd = pe - 0.60;
    else if ((current === RULES.parana && pe >= 11.55) || (current === RULES.canales && pe >= 11.7748)) cd = pe / 1.10;
    else cd = current === RULES.parana ? (pe + 30.48) / 4 : (pe + 14.94) / 2.5;

    cd = Math.max(0, Math.floor(cd * 100) / 100);
    document.getElementById('resultadoCD').textContent = cd.toFixed(2);

    gtag('event', 'calc_pe_a_cd', {tramo: current.name, pe: pe, resultado: cd.toFixed(2)});
}

// CALADO → MARGEN DE SEGURIDAD (¡AHORA PERFECTO!)
function calcMargenDesdeCD() {
    const cd = parseFloat(document.getElementById('caladoInput').value);
    if (isNaN(cd) || cd <= 0) { document.getElementById('resultadoMSBQ').textContent = "Inválido"; return; }

    let margen;

    if (cd <= current.cdStart) {
        margen = 0.60;
    }
    else if (cd >= current.cd10porc) {
        margen = cd * 0.
