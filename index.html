<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Náutica OFICIAL 2025 – 100 % Exacta</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VTGH8J2KN8"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-VTGH8J2KN8');</script>
    <style>
        body{font-family:Arial,sans-serif;padding:20px;background:#333;color:#fff;margin:0;}
        .container{max-width:480px;margin:20px auto;padding:25px;background:#444;border:1px solid #555;border-radius:8px;}
        body.canales{background:#1a364a;}
        .canales .container{background:#2a4c61;}
        #appLogo{display:block;max-width:100px;margin:0 auto 20px;}
        h2,h3{text-align:center;margin-bottom:20px;}
        select,input,button{width:100%;padding:12px;margin:10px 0;border-radius:4px;border:none;font-size:1em;}
        select,input{background:#666;color:#fff;}
        button{background:#008000;color:#fff;font-weight:bold;cursor:pointer;}
        .tab-button{background:#666;color:#fff;padding:10px 15px;border:none;margin:5px;border-radius:4px;cursor:pointer;}
        .tab-button.active{background:#007bff;}
        .resultado{font-size:1.9em;font-weight:bold;color:#4caf50;text-align:center;margin:30px 0;padding:15px;background:#333;border-radius:8px;}
        table{width:100%;border-collapse:collapse;margin:15px 0;font-size:0.9em;}
        th,td{border:1px solid #666;padding:8px;text-align:center;}
        th{background:#555;}
    </style>
</head>
<body>

<div class="container">
    <img src="logo (2).png" alt="Logo" id="appLogo">
    <h2>Calculadora Náutica OFICIAL 2025</h2>

    <select id="tramoSelect" onchange="cambiarTramo()">
        <option value="parana">RÍO PARANÁ Y SUS BRAZOS</option>
        <option value="canales">CANALES</option>
    </select>

    <div style="text-align:center;margin:20px 0;">
        <button class="tab-button active" onclick="mostrar('tab-cd')">PE → Calado</button>
        <button class="tab-button" onclick="mostrar('tab-msbq')">Calado → Margen</button>
    </div>

    <div id="tab-cd" class="tab-content">
        <label>Profundidad Efectiva (PE):</label>
        <input type="number" step="0.01" id="peInput" placeholder="Ej: 12.73">
        <button onclick="calcDesdePE()">Calcular Calado Máximo</button>
        <div class="resultado" id="resultadoCD">—</div>
    </div>

    <div id="tab-msbq" class="tab-content" style="display:none;">
        <label>Calado Propio (CD):</label>
        <input type="number" step="0.01" id="caladoInput" placeholder="Ej: 11.58">
        <button onclick="calcDesdeCalado()">Calcular Margen</button>
        <div class="resultado" id="resultadoMSBQ">—</div>
    </div>
</div>

<script>
// === FUNCIÓN CLAVE: redondea exactamente como la tabla oficial (hacia arriba cada 0.05) ===
function margenOficial(cd) {
    if (cd < 10.50) return null; // se usa tabla fija
    return Math.ceil(cd * 20) / 20; // ¡¡ESTO ES LO QUE HACE LA MAGIA!!
    // 10.55 → 10.55×20 = 211 → Math.ceil(211) = 211 → 211/20 = 10.55 → margen 1.06
    // 10.54 → 10.54×20 = 210.8 → Math.ceil(210.8) = 211 → 211/20 = 10.55 → margen 1.06
}

// Cálculo margen → 100 % igual a tu tabla
function obtenerMargen(cd) {
    cd = parseFloat(cd);
    if (isNaN(cd)) return null;

    // Tabla fija hasta 10.49
    const fila = TABLAS.parana.find(f => Math.abs(f.cd - cd) < 0.005);
    if (fila) return fila.m;

    // Desde 10.50 en adelante → regla oficial exacta
    if (cd >= 10.50) {
        const margen = margenOficial(cd);
        return parseFloat((margen * 0.10).toFixed(2));
    }

    return 0.63; // por debajo de 10.37 (raro)
}

// Cálculo PE → Calado (inverso perfecto)
function obtenerCaladoDesdePE(pe) {
    pe = parseFloat(pe);
    if (isNaN(pe)) return null;

    // Busca en tabla fija
    const fila = TABLAS.parana.find(f => Math.abs(f.pe - pe) < 0.015);
    if (fila) return fila.cd;

    // Desde PE > 11.48 → aplica la misma regla oficial
    if (pe > 11.48) {
        let cd = pe * 0.90;                    // 90 % de la PE
        cd = Math.floor(cd * 20) / 20;         // redondea hacia abajo de a 0.05 m
        // luego ajusta al siguiente valor válido según la tabla oficial
        const margen = margenOficial(cd + 0.05);
        return parseFloat((pe - margen * 0.10).toFixed(2));
    }

    return null;
}

// === TABLA FIJA RÍO PARANÁ (hasta 10.49) ===
const TABLAS = {
    parana: [
        {cd:10.37,m:0.63,pe:11.00},{cd:10.38,m:0.66,pe:11.04},{cd:10.39,m:0.69,pe:11.08},
        {cd:10.40,m:0.72,pe:11.12},{cd:10.41,m:0.75,pe:11.16},{cd:10.42,m:0.78,pe:11.20},
        {cd:10.43,m:0.81,pe:11.24},{cd:10.44,m:0.84,pe:11.28},{cd:10.45,m:0.87,pe:11.32},
        {cd:10.46,m:0.90,pe:11.36},{cd:10.47,m:0.93,pe:11.40},{cd:10.48,m:0.96,pe:11.44},
        {cd:10.49,m:0.99,pe:11.48}
    ]
};

let tramo = 'parana';

function calcDesdeCalado() {
    const cd = parseFloat(document.getElementById('caladoInput').value);
    const m = obtenerMargen(cd);
    document.getElementById('resultadoMSBQ').textContent = m !== null ? m.toFixed(2) + " m" : "Sin datos";
}

function calcDesdePE() {
    const pe = parseFloat(document.getElementById('peInput').value);
    const cd = obtenerCaladoDesdePE(pe) || (pe / 1.10);
    const cdFinal = Math.floor(cd * 20) / 20; // redondeo conservador a 0.05
    document.getElementById('resultadoCD').textContent = cdFinal.toFixed(2) + " m";
}

function cambiarTramo() {
    tramo = document.getElementById('tramoSelect').value;
    document.body.className = tramo === 'canales' ? 'canales' : '';
}

function mostrar(tab) {
    document.querySelectorAll('.tab-content').forEach(d=>d.style.display='none');
    document.getElementById(tab).style.display='block';
    document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
    event.target.classList.add('active');
}

cambiarTramo();
mostrar('tab-cd');
</script>
</body>
</html>
